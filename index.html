<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Test Site</title>
	<link rel="stylesheet" href="style/test.css">
    <script>
      console.log(document.referrer)
      console.log(location)
      if (location.pathname && location.search) {
        const url = new URL(location)
        const params = url.searchParams
        const code = params.get('code')
        if (code) {
          const service = localStorage.authService;
          if (service) {
            const authData = {
            service: service,
            code: code
            }
            localStorage.authData = JSON.stringify(authData)
          }
        }
      }
    </script>

  <body>
  	<h1 id="one">TestSite</h1>
  	<script async src="https://telegram.org/js/telegram-widget.js?4" data-telegram-login="MonexTestRobot" data-size="medium" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
<script type="text/javascript">
  function onTelegramAuth(user) {
  	console.log(user)
  	let data = JSON.stringify(user)
  	var xhr = new XMLHttpRequest();
		xhr.open("POST", 'https://newmonex.e-cash.pro/login_tg', true);
		xhr.setRequestHeader("Content-Type", "text/plain");
		xhr.send(data);
		console.log("Запрос ушел")
		xhr.onreadystatechange = function(){
			if (xhr.readyState !=4) return;
			if(xhr.status == 200) {
				console.log(xhr.responseText);
			}
		};
  }
</script>

    <script src="js/test.js"></script>
  </body>
</html>